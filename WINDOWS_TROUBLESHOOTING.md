# Windows 故障排除指南

## 版本 1.3.8 重要更新：零Native依赖重构

### 彻底解决Windows编译权限问题

为彻底解决 Windows 11 下的 npm 权限清理问题，我们在 **版本 1.3.8** 中进行了架构重构：

**重构前 (v1.3.7及之前)**：
- 使用 SQLite + better-sqlite3 (native模块)
- 存储文件：`prompts.db` (SQLite数据库)
- 问题：Windows下编译后文件被进程锁定，npm清理时权限冲突

**重构后 (v1.3.8)**：
- 使用纯JSON存储 (零native依赖)
- 存储文件：`prompts.json` (纯文本JSON)
- 优势：无编译依赖、无权限问题、跨平台兼容

### 存储格式变更

**存储位置保持不变**：
```
Windows: %LOCALAPPDATA%\.mcp_feedback\prompts.json
macOS:   ~/.mcp_feedback/prompts.json  
Linux:   ~/.config/.mcp_feedback/prompts.json
```

**存储格式变更为JSON**：
- **全新开始**：v1.3.8使用纯JSON存储，无需从旧版本迁移数据
- **零依赖安装**：首次安装即可正常使用，会自动创建默认配置
- **简洁高效**：JSON格式便于查看和维护

### 功能优势

**1. 零编译依赖**
- 移除 better-sqlite3 native模块
- Windows下安装速度更快，无C++编译过程
- 完全避免npm权限清理问题

**2. 跨平台兼容**
- 纯JavaScript实现，无平台特定代码
- JSON格式人类可读，便于调试和维护
- 支持手动编辑配置（谨慎操作）

**3. 性能优化**
- 内存缓存优化，热数据Map索引
- 原子文件写入，防止数据损坏
- 延迟保存机制，减少I/O操作

### 数据迁移（自动完成）

**初始化流程**：
1. 系统检测 `prompts.json` 是否存在
2. 如果不存在，自动创建默认配置
3. 包含预设的编码场景和基础模式
4. 立即可用，无需额外配置

**数据重置（如需要）**：
如果需要重置到默认状态：
1. 删除现有配置文件：`%LOCALAPPDATA%\.mcp_feedback\prompts.json`
2. 重新启动MCP服务
3. 系统将自动创建全新的默认配置

### 常见问题

**Q: 升级到1.3.8后找不到之前的数据？**
A: v1.3.8采用全新的JSON存储格式，不会自动迁移旧数据。如需保留旧配置，建议手动重新创建场景和提示词。

**Q: npm安装还有权限警告？**
A: 版本1.3.8已移除所有native依赖，权限问题应完全解决。如仍有警告，可能是其他依赖导致。

**Q: JSON文件损坏怎么办？**
A: 删除损坏的JSON文件，重启服务会自动创建新的默认配置。系统还会尝试从 `.backup` 文件恢复。

**Q: 可以手动编辑JSON文件吗？**
A: 技术上可以，但需要确保JSON格式正确。建议通过Web界面进行所有数据操作。

**Q: 性能是否受影响？**
A: JSON存储配合内存缓存，日常使用性能与SQLite相当，大多数操作更快。 