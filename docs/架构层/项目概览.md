# é¡¹ç›®æ¦‚è§ˆ

## é¡¹ç›®åŸºæœ¬ä¿¡æ¯

- **é¡¹ç›®åç§°**: MCP Feedback Collector (smd-mcp-feedback-collector)
- **ç‰ˆæœ¬**: 1.3.1-beta.0
- **æŠ€æœ¯æ ˆ**: Node.js + TypeScript + Vue.js 3 + Socket.IO + Express + Pinia + SQLite + Better-SQLite3
- **é¡¹ç›®ç±»å‹**: åŸºäºMCP (Model Context Protocol) çš„åœºæ™¯åŒ–åé¦ˆæ”¶é›†æœåŠ¡
- **ä¸»è¦åŠŸèƒ½**: AIå·¥ä½œæ±‡æŠ¥åé¦ˆæ”¶é›†ã€åœºæ™¯åŒ–å·¥ä½œæµç®¡ç†ã€å¤šå®¢æˆ·ç«¯æ”¯æŒã€å®æ—¶é€šä¿¡ã€æ•°æ®æŒä¹…åŒ–å­˜å‚¨

## é¡¹ç›®ç®€ä»‹

MCP Feedback Collector æ˜¯ä¸€ä¸ªåŸºäº Model Context Protocol (MCP) çš„ç°ä»£åŒ–åé¦ˆæ”¶é›†æœåŠ¡ï¼Œä¸“æ³¨äºä¸ºAIåä½œæä¾›åœºæ™¯åŒ–çš„åé¦ˆæ”¶é›†è§£å†³æ–¹æ¡ˆã€‚è¯¥é¡¹ç›®å®ç°äº†å®Œæ•´çš„MCPåè®®æ”¯æŒï¼Œæä¾›äº†ç°ä»£åŒ–çš„Webç•Œé¢ï¼Œæ”¯æŒå¤šå®¢æˆ·ç«¯åŒæ—¶è¿æ¥ï¼Œå¹¶å¼•å…¥äº†åˆ›æ–°çš„åœºæ™¯åŒ–å·¥ä½œæµç®¡ç†ç³»ç»Ÿå’ŒSQLiteæ•°æ®åº“æŒä¹…åŒ–å­˜å‚¨ã€‚

## æ ¸å¿ƒæŠ€æœ¯æ¶æ„

### ğŸ—ï¸ æ•´ä½“æ¶æ„è®¾è®¡

```mermaid
graph TB
    subgraph "å®¢æˆ·ç«¯å±‚"
        A[Cursor IDE] --> B[MCP Client]
        C[Web Browser] --> D[Vue.js Frontend]
        E[Stagewise Plugin] --> F[Toolbar Integration]
    end
    
    subgraph "æœåŠ¡å±‚"
        G[MCP Server] --> H[Server Coordinator]
        I[Web Server] --> H
        J[Toolbar Server] --> H
        H --> K[Session Management]
    end
    
    subgraph "ä¸šåŠ¡å±‚"
        L[Scene Manager] --> M[Prompt Manager]
        N[Feedback Processor] --> O[Image Processor]
        P[Socket.IO Handler] --> Q[Performance Monitor]
    end
    
    subgraph "æ•°æ®å±‚"
        R[SQLite Database] --> S[Scene Storage]
        R --> T[Prompt Storage]
        R --> U[Session Storage]
        V[File System] --> W[Image Storage]
        V --> X[Log Storage]
    end
    
    B --> G
    D --> I
    F --> J
    G --> L
    I --> N
    J --> L
    L --> R
    N --> V
```

### ğŸ­ åœºæ™¯åŒ–ä¸šåŠ¡æ¶æ„

```mermaid
graph LR
    subgraph "åœºæ™¯åŒ–å·¥ä½œæµ"
        A[å·¥ä½œåœºæ™¯] --> B[æ“ä½œæ¨¡å¼]
        B --> C[æç¤ºè¯æ¨¡æ¿]
        C --> D[AIå¤„ç†]
        D --> E[ç”¨æˆ·åé¦ˆ]
        E --> F[åé¦ˆå­˜å‚¨]
    end
    
    subgraph "æ•°æ®æ¨¡å‹"
        G[Scene] --> H[SceneMode]
        H --> I[ScenePrompt]
        I --> J[FeedbackData]
    end
    
    subgraph "çŠ¶æ€ç®¡ç†"
        K[Scenes Store] --> L[Current Selection]
        L --> M[Mode Options]
        M --> N[Prompt Generation]
    end
    
    A --> G
    K --> A
```

## æ ¸å¿ƒç‰¹æ€§

### ğŸ”Œ MCPåè®®æ”¯æŒ
- **å®Œæ•´MCPå®ç°**: åŸºäº@modelcontextprotocol/sdkå®ç°æ ‡å‡†MCPåè®®
- **å¤šä¼ è¾“æ¨¡å¼**: æ”¯æŒStdioå’ŒHTTPä¼ è¾“æ¨¡å¼
- **å·¥å…·æ³¨å†Œ**: æä¾›`collect_feedback`å·¥å…·æ¥å£
- **ä¼šè¯éš”ç¦»**: æ”¯æŒå¤šå®¢æˆ·ç«¯ä¼šè¯ç‹¬ç«‹ç®¡ç†
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶

### ğŸŒ ç°ä»£åŒ–Webç•Œé¢
- **Vue.js 3**: åŸºäºComposition APIçš„ç°ä»£åŒ–å‰ç«¯æ¡†æ¶
- **å“åº”å¼è®¾è®¡**: é€‚é…å„ç§è®¾å¤‡å’Œå±å¹•å°ºå¯¸
- **å®æ—¶é€šä¿¡**: Socket.IOå®ç°å‰åç«¯å®æ—¶åŒå‘é€šä¿¡
- **TypeScript**: å…¨æ ˆTypeScriptå¼€å‘ï¼Œå¼ºç±»å‹ä¿è¯
- **Viteæ„å»º**: å¿«é€Ÿçš„å¼€å‘å’Œæ„å»ºä½“éªŒ

### ğŸ­ åœºæ™¯åŒ–å·¥ä½œæµç®¡ç†
- **å¤šåœºæ™¯æ”¯æŒ**: åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤è‡ªå®šä¹‰å·¥ä½œåœºæ™¯
- **åœºæ™¯æ¨¡å¼**: æ¯ä¸ªåœºæ™¯å¯é…ç½®å¤šç§æ“ä½œæ¨¡å¼
- **é»˜è®¤é…ç½®**: å†…ç½®ç¼–ç åœºæ™¯ï¼ŒåŒ…å«è®¨è®ºã€ç¼–è¾‘ã€æœç´¢ä¸‰ç§æ¨¡å¼
- **å®æ—¶åˆ‡æ¢**: æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€åˆ‡æ¢åœºæ™¯å’Œæ¨¡å¼
- **åœºæ™¯å¯¼å…¥å¯¼å‡º**: æ”¯æŒåœºæ™¯é…ç½®çš„æ‰¹é‡ç®¡ç†
- **å¿«æ·é”®æ”¯æŒ**: åœºæ™¯æ¨¡å¼æ”¯æŒè‡ªå®šä¹‰å¿«æ·é”®

### ğŸ’¾ SQLiteæ•°æ®åº“å­˜å‚¨
- **Better-SQLite3**: é«˜æ€§èƒ½çš„SQLiteæ•°æ®åº“å¼•æ“
- **è·¨å¹³å°å­˜å‚¨**: æ ¹æ®æ“ä½œç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©å­˜å‚¨è·¯å¾„
- **æ•°æ®åº“è¿ç§»**: æ”¯æŒç‰ˆæœ¬å‡çº§å’Œæ•°æ®è¿ç§»
- **äº‹åŠ¡å¤„ç†**: å®Œæ•´çš„ACIDäº‹åŠ¡æ”¯æŒ
- **æ•°æ®å®Œæ•´æ€§**: å¤–é”®çº¦æŸå’Œæ•°æ®éªŒè¯

### ğŸ“Š PiniaçŠ¶æ€ç®¡ç†
- **æ¨¡å—åŒ–Store**: æŒ‰åŠŸèƒ½æ¨¡å—åˆ’åˆ†çš„çŠ¶æ€ç®¡ç†
- **å“åº”å¼çŠ¶æ€**: Vue 3å“åº”å¼ç³»ç»Ÿé›†æˆ
- **TypeScriptæ”¯æŒ**: å®Œæ•´çš„ç±»å‹æ¨å¯¼å’Œæ£€æŸ¥
- **çŠ¶æ€æŒä¹…åŒ–**: å…³é”®çŠ¶æ€çš„æŒä¹…åŒ–å­˜å‚¨
- **å¼€å‘å·¥å…·**: Vue DevToolsé›†æˆæ”¯æŒ

### ğŸ–¼ï¸ å›¾ç‰‡å¤„ç†ç³»ç»Ÿ
- **å¤šæ ¼å¼æ”¯æŒ**: æ”¯æŒJPEGã€PNGã€WebPç­‰å›¾ç‰‡æ ¼å¼
- **å®¢æˆ·ç«¯å‹ç¼©**: Canvas APIå®ç°å›¾ç‰‡å‹ç¼©
- **åç«¯å¤„ç†**: æœåŠ¡ç«¯å›¾ç‰‡å¤„ç†å’Œå­˜å‚¨
- **é¢„è§ˆåŠŸèƒ½**: å®æ—¶å›¾ç‰‡é¢„è§ˆå’Œç®¡ç†
- **å¤§å°é™åˆ¶**: å¯é…ç½®çš„æ–‡ä»¶å¤§å°é™åˆ¶

### ğŸ”Œ Stagewiseå·¥å…·æ é›†æˆ
- **æ’ä»¶é›†æˆ**: é›†æˆ@stagewise/toolbar-vueæ’ä»¶
- **å¼€å‘ç¯å¢ƒ**: ä»…åœ¨å¼€å‘ç¯å¢ƒæ˜¾ç¤ºå·¥å…·æ 
- **UIé€‰æ‹©å·¥å…·**: æä¾›å¢å¼ºçš„UIäº¤äº’åŠŸèƒ½
- **RPCæ¡¥æ¥**: æ”¯æŒå·¥å…·æ ä¸åº”ç”¨çš„é€šä¿¡

### ğŸ”„ å¤šå®¢æˆ·ç«¯æ”¯æŒ
- **ä¼šè¯éš”ç¦»**: æ¯ä¸ªå®¢æˆ·ç«¯ç‹¬ç«‹çš„ä¼šè¯ç®¡ç†
- **èµ„æºå…±äº«**: æ™ºèƒ½çš„èµ„æºåˆ†é…å’Œå†²çªé¿å…
- **å®¢æˆ·ç«¯è¯†åˆ«**: è‡ªåŠ¨è¯†åˆ«å®¢æˆ·ç«¯ç¯å¢ƒå’Œé…ç½®
- **çŠ¶æ€åŒæ­¥**: å¤šå®¢æˆ·ç«¯çŠ¶æ€çš„å®æ—¶åŒæ­¥

### ğŸ“ˆ æ€§èƒ½ç›‘æ§
- **å®æ—¶ç›‘æ§**: å†…ç½®æ€§èƒ½ç›‘æ§å’Œå¥åº·æ£€æŸ¥
- **æŒ‡æ ‡æ”¶é›†**: è¯·æ±‚å“åº”æ—¶é—´ã€æˆåŠŸç‡ç­‰å…³é”®æŒ‡æ ‡
- **èµ„æºç›‘æ§**: CPUã€å†…å­˜ä½¿ç”¨æƒ…å†µç›‘æ§
- **æ—¥å¿—ç³»ç»Ÿ**: åˆ†çº§æ—¥å¿—è®°å½•å’Œåˆ†æ

## æŠ€æœ¯æ ˆè¯¦ç»†è¯´æ˜

### åç«¯æŠ€æœ¯æ ˆ
- **Node.js**: 18.0.0+ è¿è¡Œæ—¶ç¯å¢ƒ
- **TypeScript**: 5.2.2 ç±»å‹ç³»ç»Ÿ
- **Express**: 4.18.2 Webæ¡†æ¶
- **Socket.IO**: 4.7.2 å®æ—¶é€šä¿¡
- **Better-SQLite3**: 9.2.2 æ•°æ®åº“å¼•æ“
- **@modelcontextprotocol/sdk**: 1.12.3 MCPåè®®å®ç°

### å‰ç«¯æŠ€æœ¯æ ˆ
- **Vue.js**: 3.5.13 å‰ç«¯æ¡†æ¶
- **Pinia**: 3.0.3 çŠ¶æ€ç®¡ç†
- **TypeScript**: 5.8.3 ç±»å‹ç³»ç»Ÿ
- **Vite**: 6.3.5 æ„å»ºå·¥å…·
- **Socket.IO Client**: 4.8.1 å®æ—¶é€šä¿¡å®¢æˆ·ç«¯
- **@stagewise/toolbar-vue**: 0.4.4 å·¥å…·æ æ’ä»¶

### å¼€å‘å·¥å…·é“¾
- **tsx**: 3.14.0 TypeScriptæ‰§è¡Œå™¨
- **ESLint**: 8.50.0 ä»£ç æ£€æŸ¥
- **Concurrently**: 8.2.2 å¹¶å‘ä»»åŠ¡æ‰§è¡Œ
- **Commander**: 11.1.0 CLIå·¥å…·

## ä¸»è¦ç›®å½•ç»“æ„

```
mcp-feedback-collector/
â”œâ”€â”€ src/                        # åç«¯æºç ç›®å½•
â”‚   â”œâ”€â”€ server/                 # æœåŠ¡å™¨æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ mcp-server.ts       # MCPåè®®æœåŠ¡å™¨
â”‚   â”‚   â”œâ”€â”€ web-server.ts       # WebæœåŠ¡å™¨å’ŒSocket.IO
â”‚   â”‚   â”œâ”€â”€ toolbar-server.ts   # Stagewiseå·¥å…·æ æœåŠ¡å™¨
â”‚   â”‚   â”œâ”€â”€ server-coordinator.ts # æœåŠ¡å™¨åè°ƒå™¨
â”‚   â”‚   â””â”€â”€ web-server-manager.ts # WebæœåŠ¡å™¨ç®¡ç†å™¨
â”‚   â”œâ”€â”€ utils/                  # å·¥å…·ç±»åº“
â”‚   â”‚   â”œâ”€â”€ prompt-database.ts  # SQLiteæ•°æ®åº“ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ prompt-manager.ts   # æç¤ºè¯ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ session-storage.ts  # ä¼šè¯å­˜å‚¨ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ image-processor.ts  # å›¾ç‰‡å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ performance-monitor.ts # æ€§èƒ½ç›‘æ§å™¨
â”‚   â”‚   â””â”€â”€ logger.ts           # æ—¥å¿—ç³»ç»Ÿ
â”‚   â”œâ”€â”€ config/                 # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ toolbar/                # Stagewiseå·¥å…·æ é›†æˆ
â”‚   â””â”€â”€ types/                  # å…¨å±€ç±»å‹å®šä¹‰
â”œâ”€â”€ frontend/                   # å‰ç«¯æºç ç›®å½•
â”‚   â””â”€â”€ src/                    # Vue.jsåº”ç”¨æºç 
â”‚       â”œâ”€â”€ components/         # Vueç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ SceneManagement.vue # åœºæ™¯ç®¡ç†ç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ FeedbackForm.vue     # åé¦ˆè¡¨å•ç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ SceneSelector.vue    # åœºæ™¯é€‰æ‹©å™¨
â”‚       â”‚   â””â”€â”€ PhraseModeSelector.vue # æ¨¡å¼é€‰æ‹©å™¨
â”‚       â”œâ”€â”€ stores/             # PiniaçŠ¶æ€ç®¡ç†
â”‚       â”‚   â”œâ”€â”€ scenes.ts       # åœºæ™¯çŠ¶æ€ç®¡ç†
â”‚       â”‚   â”œâ”€â”€ app.ts          # åº”ç”¨çŠ¶æ€ç®¡ç†
â”‚       â”‚   â””â”€â”€ feedback.ts     # åé¦ˆçŠ¶æ€ç®¡ç†
â”‚       â”œâ”€â”€ services/           # å‰ç«¯æœåŠ¡å±‚
â”‚       â”‚   â”œâ”€â”€ promptService.ts # æç¤ºè¯æœåŠ¡
â”‚       â”‚   â”œâ”€â”€ socket.ts       # Socket.IOæœåŠ¡
â”‚       â”‚   â””â”€â”€ imageService.ts # å›¾ç‰‡æœåŠ¡
â”‚       â””â”€â”€ types/              # å‰ç«¯ç±»å‹å®šä¹‰
â”œâ”€â”€ docs/                       # é¡¹ç›®æ–‡æ¡£ç›®å½•
â”œâ”€â”€ scripts/                    # æ„å»ºå’Œæµ‹è¯•è„šæœ¬
â””â”€â”€ logs/                       # æ—¥å¿—æ–‡ä»¶ç›®å½•
```

## æ•°æ®æ¨¡å‹æ¶æ„

### æ ¸å¿ƒæ•°æ®å®ä½“

```mermaid
erDiagram
    Scene {
        string id PK
        string name
        string description
        string icon
        boolean is_default
        integer sort_order
        integer created_at
        integer updated_at
    }
    
    SceneMode {
        string id PK
        string scene_id FK
        string name
        string description
        string shortcut
        boolean is_default
        integer sort_order
        string default_feedback
        integer created_at
        integer updated_at
    }
    
    ScenePrompt {
        string scene_id FK
        string mode_id FK
        string prompt
        integer created_at
        integer updated_at
    }
    
    FeedbackData {
        string text
        array images
        integer timestamp
        string session_id
    }
    
    Scene ||--o{ SceneMode : "has modes"
    Scene ||--o{ ScenePrompt : "has prompts"
    SceneMode ||--o{ ScenePrompt : "uses prompt"
```

### é»˜è®¤åœºæ™¯é…ç½®

```typescript
// å†…ç½®ç¼–ç åœºæ™¯
const defaultScene = {
  id: 'coding',
  name: 'ç¼–ç åœºæ™¯',
  description: 'ä¸“ä¸ºä»£ç å¼€å‘å’ŒæŠ€æœ¯è®¨è®ºè®¾è®¡çš„å·¥ä½œåœºæ™¯',
  modes: [
    {
      id: 'discuss',
      name: 'è®¨è®º',
      description: 'ç”¨äºæŠ€æœ¯è®¨è®ºå’Œé—®é¢˜åˆ†æ',
      shortcut: '1',
      isDefault: true
    },
    {
      id: 'edit',
      name: 'ç¼–è¾‘',
      description: 'ç”¨äºä»£ç ç¼–è¾‘å’Œä¿®æ”¹å»ºè®®',
      shortcut: '2'
    },
    {
      id: 'search',
      name: 'æœç´¢',
      description: 'ç”¨äºä»£ç æœç´¢å’ŒæŸ¥æ‰¾',
      shortcut: '3'
    }
  ]
}
```

## éƒ¨ç½²å’Œé›†æˆæ–¹å¼

### å¼€å‘ç¯å¢ƒ
- **å‰ç«¯å¼€å‘æœåŠ¡å™¨**: Viteå¼€å‘æœåŠ¡å™¨ï¼Œçƒ­é‡è½½æ”¯æŒ
- **åç«¯å¼€å‘æœåŠ¡å™¨**: tsx watchæ¨¡å¼ï¼Œè‡ªåŠ¨é‡å¯
- **å¹¶å‘å¼€å‘**: concurrentlyåŒæ—¶å¯åŠ¨å‰åç«¯æœåŠ¡
- **æ•°æ®åº“**: SQLiteè‡ªåŠ¨åˆå§‹åŒ–å’Œè¿ç§»

### ç”Ÿäº§ç¯å¢ƒ
- **å‰ç«¯æ„å»º**: Vue.jsåº”ç”¨æ„å»ºä¸ºé™æ€æ–‡ä»¶
- **åç«¯ç¼–è¯‘**: TypeScriptç¼–è¯‘ä¸ºJavaScript
- **NPMåŒ…å‘å¸ƒ**: æ”¯æŒå…¨å±€å®‰è£…å’Œä½¿ç”¨
- **æ•°æ®åº“**: è·¨å¹³å°SQLiteæ•°æ®åº“æ–‡ä»¶

### é›†æˆæ–¹å¼
- **Cursor IDE**: MCPé…ç½®é›†æˆ
- **å…¨å±€å®‰è£…**: `npm install -g smd-mcp-feedback-collector`
- **æœ¬åœ°å¼€å‘**: `npm run dev:full`
- **æŒä¹…åŒ–æœåŠ¡**: `npm run start:persistent`

## ğŸ§­ å¯¼èˆªé“¾æ¥

- **ğŸ“‹ [è¿”å›ä¸»ç›®å½•](../README.md)** - è¿”å›æ–‡æ¡£å¯¼èˆªä¸­å¿ƒ
- **ğŸ—ï¸ [è¿”å›æ¶æ„å±‚ç›®å½•](./index.md)** - è¿”å›æ¶æ„å±‚å¯¼èˆª
- **ğŸ—ï¸ [æ¶æ„è®¾è®¡](./æ¶æ„è®¾è®¡.md)** - æŸ¥çœ‹è¯¦ç»†æ¶æ„è®¾è®¡
- **ğŸ”„ [ä¸‹ä¸€å±‚ï¼šäº¤äº’å±‚](../äº¤äº’å±‚/index.md)** - æŸ¥çœ‹æ¨¡å—äº¤äº’åˆ†æ

---

*é¡¹ç›®æ¦‚è§ˆæœ€åæ›´æ–°: 2024å¹´1æœˆ* 