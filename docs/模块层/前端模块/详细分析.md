# å‰ç«¯æ ¸å¿ƒæ¨¡å—è¯¦ç»†åˆ†æ

## æ¨¡å—æ¦‚è¿°

### åŠŸèƒ½èŒè´£
å‰ç«¯æ ¸å¿ƒæ¨¡å—æ˜¯MCP Feedback Collectorçš„ç”¨æˆ·ç•Œé¢å±‚ï¼ŒåŸºäºVue.js 3æ„å»ºï¼Œè´Ÿè´£ï¼š
- **åé¦ˆæ”¶é›†ç•Œé¢**: æä¾›ç”¨æˆ·å‹å¥½çš„åé¦ˆæäº¤å’Œç®¡ç†ç•Œé¢
- **åœºæ™¯åŒ–å·¥ä½œæµ**: æ”¯æŒå¤šåœºæ™¯ã€å¤šæ¨¡å¼çš„AIåä½œå·¥ä½œæµç¨‹
- **å®æ—¶é€šä¿¡**: é€šè¿‡Socket.IOä¸åç«¯è¿›è¡Œå®æ—¶æ•°æ®äº¤æ¢
- **çŠ¶æ€ç®¡ç†**: ä½¿ç”¨Piniaç®¡ç†å¤æ‚çš„åº”ç”¨çŠ¶æ€
- **å›¾ç‰‡å¤„ç†**: æ”¯æŒå›¾ç‰‡ä¸Šä¼ ã€é¢„è§ˆå’Œå¤„ç†åŠŸèƒ½

### æŠ€æœ¯æ¶æ„
- **æ¡†æ¶**: Vue.js 3 (Composition API)
- **çŠ¶æ€ç®¡ç†**: Pinia
- **æ„å»ºå·¥å…·**: Vite
- **ç±»å‹ç³»ç»Ÿ**: TypeScript
- **é€šä¿¡**: Socket.IO Client
- **æ ·å¼**: åŸç”ŸCSS (æ¨¡å—åŒ–)

### ä¾èµ–å…³ç³»
- **å¯¹åç«¯çš„ä¾èµ–**: é€šè¿‡Socket.IOå’ŒHTTP APIä¸åç«¯æœåŠ¡é€šä¿¡
- **å¯¹å¤–æ¥å£**: æä¾›Webç•Œé¢ä¾›ç”¨æˆ·è®¿é—®ï¼Œé›†æˆStagewiseå·¥å…·æ 

## ä¸šåŠ¡æ¶æ„è®¾è®¡

### 1. åœºæ™¯åŒ–ä¸šåŠ¡æ¨¡å‹

```mermaid
graph TB
    subgraph "åœºæ™¯åŒ–ä¸šåŠ¡å±‚"
        A[åœºæ™¯ç®¡ç†] --> B[æ¨¡å¼ç®¡ç†]
        B --> C[æç¤ºè¯ç®¡ç†]
        C --> D[åé¦ˆæ”¶é›†]
    end
    
    subgraph "æ ¸å¿ƒä¸šåŠ¡å®ä½“"
        E[Scene åœºæ™¯] --> F[SceneMode æ¨¡å¼]
        F --> G[Prompt æç¤ºè¯]
        G --> H[Feedback åé¦ˆ]
    end
    
    subgraph "ä¸šåŠ¡æµç¨‹"
        I[é€‰æ‹©åœºæ™¯] --> J[é€‰æ‹©æ¨¡å¼]
        J --> K[ç”Ÿæˆæç¤ºè¯]
        K --> L[AIå¤„ç†]
        L --> M[ç”¨æˆ·åé¦ˆ]
        M --> N[åé¦ˆå­˜å‚¨]
    end
    
    A --> E
    I --> A
```

### 2. çŠ¶æ€ç®¡ç†æ¶æ„

```mermaid
graph LR
    subgraph "Pinia Store æ¶æ„"
        A[App Store] --> B[åº”ç”¨å…¨å±€çŠ¶æ€]
        C[Scenes Store] --> D[åœºæ™¯ä¸šåŠ¡çŠ¶æ€]
        E[Connection Store] --> F[è¿æ¥çŠ¶æ€]
        G[Feedback Store] --> H[åé¦ˆæ•°æ®çŠ¶æ€]
    end
    
    subgraph "çŠ¶æ€åŒæ­¥"
        B --> I[ç»„ä»¶å“åº”å¼æ›´æ–°]
        D --> I
        F --> I
        H --> I
    end
    
    subgraph "ä¸šåŠ¡é€»è¾‘"
        J[åœºæ™¯åˆ‡æ¢] --> C
        K[æ¨¡å¼é€‰æ‹©] --> C
        L[åé¦ˆæäº¤] --> G
        M[è¿æ¥ç®¡ç†] --> E
    end
```

## æ ¸å¿ƒä¸šåŠ¡å®ä½“

### 1. Scene (åœºæ™¯)

```typescript
interface Scene {
  id: string              // åœºæ™¯å”¯ä¸€æ ‡è¯†
  name: string           // åœºæ™¯åç§°
  description: string    // åœºæ™¯æè¿°
  icon?: string          // åœºæ™¯å›¾æ ‡
  isDefault: boolean     // æ˜¯å¦ä¸ºé»˜è®¤åœºæ™¯
  sortOrder: number      // æ’åºé¡ºåº
  createdAt: number      // åˆ›å»ºæ—¶é—´
  updatedAt: number      // æ›´æ–°æ—¶é—´
}
```

**ä¸šåŠ¡å«ä¹‰**: åœºæ™¯ä»£è¡¨ä¸åŒçš„å·¥ä½œä¸Šä¸‹æ–‡ï¼Œå¦‚"ä»£ç å¼€å‘"ã€"æ–‡æ¡£ç¼–å†™"ã€"é—®é¢˜è°ƒè¯•"ç­‰ã€‚æ¯ä¸ªåœºæ™¯åŒ…å«å¤šä¸ªæ“ä½œæ¨¡å¼ã€‚

### 2. SceneMode (åœºæ™¯æ¨¡å¼)

```typescript
interface SceneMode {
  id: string              // æ¨¡å¼å”¯ä¸€æ ‡è¯†
  sceneId: string        // æ‰€å±åœºæ™¯ID
  name: string           // æ¨¡å¼åç§°
  description: string    // æ¨¡å¼æè¿°
  shortcut?: string      // å¿«æ·é”®
  isDefault: boolean     // æ˜¯å¦ä¸ºé»˜è®¤æ¨¡å¼
  sortOrder: number      // æ’åºé¡ºåº
  createdAt: number      // åˆ›å»ºæ—¶é—´
  updatedAt: number      // æ›´æ–°æ—¶é—´
}
```

**ä¸šåŠ¡å«ä¹‰**: æ¨¡å¼ä»£è¡¨åœ¨ç‰¹å®šåœºæ™¯ä¸‹çš„å…·ä½“æ“ä½œç±»å‹ï¼Œå¦‚åœ¨"ä»£ç å¼€å‘"åœºæ™¯ä¸‹çš„"è®¨è®º"ã€"ç¼–è¾‘"ã€"æœç´¢"æ¨¡å¼ã€‚

### 3. CurrentSelection (å½“å‰é€‰æ‹©)

```typescript
interface CurrentSelection {
  sceneId: string        // å½“å‰åœºæ™¯ID
  modeId: string         // å½“å‰æ¨¡å¼ID
}
```

**ä¸šåŠ¡å«ä¹‰**: è¡¨ç¤ºç”¨æˆ·å½“å‰çš„å·¥ä½œä¸Šä¸‹æ–‡ï¼Œå†³å®šäº†AIçš„è¡Œä¸ºæ¨¡å¼å’Œæç¤ºè¯å†…å®¹ã€‚

### 4. FeedbackData (åé¦ˆæ•°æ®)

```typescript
interface FeedbackData {
  text: string           // åé¦ˆæ–‡æœ¬å†…å®¹
  images: ImageFile[]    // é™„åŠ å›¾ç‰‡
  timestamp: number      // æäº¤æ—¶é—´
  sessionId: string | null // ä¼šè¯ID
}
```

**ä¸šåŠ¡å«ä¹‰**: ç”¨æˆ·å¯¹AIå·¥ä½œæ±‡æŠ¥çš„åé¦ˆï¼Œæ”¯æŒæ–‡æœ¬å’Œå›¾ç‰‡å½¢å¼ã€‚

## ä¸šåŠ¡æµç¨‹åˆ†æ

### 1. åœºæ™¯åŒ–å·¥ä½œæµç¨‹

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant SM as åœºæ™¯ç®¡ç†å™¨
    participant PS as æç¤ºè¯æœåŠ¡
    participant AS as App Store
    participant SS as Scenes Store
    
    U->>SM: é€‰æ‹©å·¥ä½œåœºæ™¯
    SM->>SS: åŠ è½½åœºæ™¯é…ç½®
    SS->>PS: è·å–åœºæ™¯æ¨¡å¼åˆ—è¡¨
    PS-->>SS: è¿”å›æ¨¡å¼æ•°æ®
    SS->>AS: åŒæ­¥å½“å‰é€‰æ‹©
    AS->>U: æ›´æ–°ç•Œé¢æ˜¾ç¤º
    
    U->>SM: é€‰æ‹©æ“ä½œæ¨¡å¼
    SM->>PS: è·å–æ¨¡å¼æç¤ºè¯
    PS-->>SM: è¿”å›æç¤ºè¯æ¨¡æ¿
    SM->>AS: æ›´æ–°å½“å‰æ¨¡å¼
    AS->>U: ç”ŸæˆAIæç¤ºè¯
```

### 2. åé¦ˆæ”¶é›†æµç¨‹

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant FC as åé¦ˆç»„ä»¶
    participant FS as åé¦ˆStore
    participant Socket as Socket.IO
    participant Backend as åç«¯æœåŠ¡
    
    Backend->>Socket: æ¨é€å·¥ä½œæ±‡æŠ¥
    Socket->>FC: workSummaryUpdateäº‹ä»¶
    FC->>U: æ˜¾ç¤ºå·¥ä½œæ±‡æŠ¥
    
    U->>FC: å¡«å†™åé¦ˆå†…å®¹
    U->>FC: ä¸Šä¼ åé¦ˆå›¾ç‰‡
    U->>FC: æäº¤åé¦ˆ
    
    FC->>FS: å­˜å‚¨åé¦ˆæ•°æ®
    FS->>Socket: submitFeedbackäº‹ä»¶
    Socket->>Backend: ä¼ è¾“åé¦ˆæ•°æ®
    Backend-->>Socket: åé¦ˆå¤„ç†ç»“æœ
    Socket-->>FC: æ˜¾ç¤ºæäº¤çŠ¶æ€
```

## æ ¸å¿ƒStoreåˆ†æ

### 1. App Store (`app.ts`)

**ä¸»è¦èŒè´£**:
- ç®¡ç†åº”ç”¨å…¨å±€çŠ¶æ€
- å¤„ç†ç”¨æˆ·ç•Œé¢é…ç½®
- åè°ƒå„ä¸ªå­Storeçš„çŠ¶æ€

**æ ¸å¿ƒçŠ¶æ€**:
```typescript
interface AppState {
  isLoading: boolean
  currentView: string
  uiConfig: UIConfig
  globalSettings: GlobalSettings
}
```

### 2. Scenes Store (`scenes.ts`)

**ä¸»è¦èŒè´£**:
- ç®¡ç†åœºæ™¯å’Œæ¨¡å¼æ•°æ®
- å¤„ç†åœºæ™¯åˆ‡æ¢é€»è¾‘
- æä¾›åœºæ™¯ç›¸å…³çš„è®¡ç®—å±æ€§

**æ ¸å¿ƒçŠ¶æ€**:
```typescript
interface ScenesState {
  scenes: Scene[]
  currentSelection: CurrentSelection
  isLoading: boolean
  error: string | null
}
```

### 3. Connection Store (`connection.ts`)

**ä¸»è¦èŒè´£**:
- ç®¡ç†Socket.IOè¿æ¥çŠ¶æ€
- å¤„ç†è¿æ¥é‡è¯•é€»è¾‘
- ç›‘å¬è¿æ¥çŠ¶æ€å˜åŒ–

**æ ¸å¿ƒçŠ¶æ€**:
```typescript
interface ConnectionState {
  isConnected: boolean
  connectionId: string | null
  lastConnected: number | null
  retryCount: number
}
```

### 4. Feedback Store (`feedback.ts`)

**ä¸»è¦èŒè´£**:
- ç®¡ç†åé¦ˆæ•°æ®çŠ¶æ€
- å¤„ç†åé¦ˆæäº¤é€»è¾‘
- ç»´æŠ¤åé¦ˆå†å²è®°å½•

**æ ¸å¿ƒçŠ¶æ€**:
```typescript
interface FeedbackState {
  currentFeedback: FeedbackData | null
  feedbackHistory: FeedbackData[]
  isSubmitting: boolean
  lastSubmitted: number | null
}
```

## æœåŠ¡å±‚æ¶æ„

### 1. Socket Service (`socket.ts`)

**åŠŸèƒ½**: Socket.IOå®¢æˆ·ç«¯å°è£…
**ä¸»è¦æ–¹æ³•**:
- `connect()`: å»ºç«‹Socketè¿æ¥
- `disconnect()`: æ–­å¼€è¿æ¥
- `emit()`: å‘é€äº‹ä»¶
- `on()`: ç›‘å¬äº‹ä»¶

### 2. Prompt Service (`promptService.ts`)

**åŠŸèƒ½**: æç¤ºè¯ç›¸å…³æœåŠ¡
**ä¸»è¦æ–¹æ³•**:
- `getPromptForMode()`: è·å–æ¨¡å¼æç¤ºè¯
- `generateCustomPrompt()`: ç”Ÿæˆè‡ªå®šä¹‰æç¤ºè¯
- `savePromptTemplate()`: ä¿å­˜æç¤ºè¯æ¨¡æ¿

### 3. Image Service (`imageService.ts`)

**åŠŸèƒ½**: å›¾ç‰‡å¤„ç†æœåŠ¡
**ä¸»è¦æ–¹æ³•**:
- `compressImage()`: å›¾ç‰‡å‹ç¼©
- `uploadImage()`: å›¾ç‰‡ä¸Šä¼ 
- `validateImage()`: å›¾ç‰‡éªŒè¯

### 4. Phrase Service (`phraseService.ts`)

**åŠŸèƒ½**: å¿«æ·è¯­å¤„ç†æœåŠ¡
**ä¸»è¦æ–¹æ³•**:
- `getQuickPhrases()`: è·å–å¿«æ·è¯­
- `applyPhrase()`: åº”ç”¨å¿«æ·è¯­
- `saveCustomPhrase()`: ä¿å­˜è‡ªå®šä¹‰å¿«æ·è¯­

## ğŸ“ æ·±å…¥åˆ†æå»ºè®®

### ğŸ¯ ç»„ä»¶åˆ†æä¼˜å…ˆçº§
åŸºäºå¤æ‚åº¦å’Œé‡è¦æ€§ï¼Œå»ºè®®æŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§æ·±å…¥åˆ†æç»„ä»¶ï¼š
1. **åœºæ™¯ç®¡ç†ç»„ä»¶** - å¤æ‚çš„åœºæ™¯åŒ–å·¥ä½œæµå®ç°
2. **åé¦ˆè¡¨å•ç»„ä»¶** - æ ¸å¿ƒåé¦ˆæ”¶é›†åŠŸèƒ½
3. **çŸ­è¯­æ¨¡å¼é€‰æ‹©å™¨** - æ¨¡å¼åˆ‡æ¢å’Œæç¤ºè¯ç”Ÿæˆ
4. **å›¾ç‰‡ä¸Šä¼ ç»„ä»¶** - å›¾ç‰‡å¤„ç†å’Œä¸Šä¼ åŠŸèƒ½

### ğŸ”— ç›¸å…³æ–‡æ¡£æ¨è
- **ç»„ä»¶è¯¦ç»†åˆ†æ**: [å‰ç«¯ç»„ä»¶æ¨¡å—](./ç»„ä»¶/index.md)
- **æœåŠ¡å±‚åˆ†æ**: [å‰ç«¯æœåŠ¡æ¨¡å—](./æœåŠ¡/index.md)
- **çŠ¶æ€ç®¡ç†**: [å‰ç«¯çŠ¶æ€ç®¡ç†](./çŠ¶æ€ç®¡ç†/index.md)

## ğŸ§­ å¯¼èˆªé“¾æ¥

- **ğŸ“‹ [è¿”å›ä¸»ç›®å½•](../../README.md)** - è¿”å›æ–‡æ¡£å¯¼èˆªä¸­å¿ƒ
- **ğŸ”§ [è¿”å›å‰ç«¯æ¨¡å—ç›®å½•](./index.md)** - è¿”å›å‰ç«¯æ¨¡å—å¯¼èˆª
- **ğŸ”§ [è¿”å›æ¨¡å—å±‚ç›®å½•](../index.md)** - è¿”å›æ¨¡å—å±‚å¯¼èˆª
- **âš™ï¸ [åç«¯æ¨¡å—æ–‡æ¡£](../åç«¯æ¨¡å—/index.md)** - æŸ¥çœ‹åç«¯æ¨¡å—åˆ†æ

---

*å‰ç«¯æ ¸å¿ƒæ¨¡å—æœ€åæ›´æ–°: 2024å¹´1æœˆ* 